• Se debe tener el proyecto anterior (API REST Express) y seguir su paso a paso •

• Docker •

1. Instalar docker: - Descargar e instalar docker desde la página: https://docs.docker.com/desktop/windows/install/
                    - Habilitar las caracteristicas del sistema: Hyper-V, Windows Subsystem Linuxm, Virtual Machine Plataform.
                    - Habilitar desde la BIOS: Virtualización.
                    - Descargar WSL2.
                    - Reiniciar y verificar que todo funcione correctamente.

2. Configuración de Postgres en Docker: - En esta url podemos encontrar información sobre las imágenes: https://hub.docker.com/
                                        - Crear la carpeta: postgres_data (Acá se guardara la persistencia)
                                        - Agregar en el archivo .gitignore: postgres_data (Para que no persista en el repo)
                                        - Crear archivo: docker-compose.yml
                                        - Ejecutar contenedor docker: docker-compose up -d postgresMyDB (Se debe tener abierto docker)
                                        - Verificar que está corriendo: docker-compose ps
                                        - Dejar de ejecutar contenedor docker: docker-compose down

3. Explorar nuestra BD que está en un contenedor: • Forma Terminal
                                                  - docker-compose exec postgresMyDB bash (Conectarnos al contenedor vía terminal)
                                                  - psql -h localhost -d my_store -U admin (Conectarnos a la BD)
                                                  - \d+ (Ver estructura de la BD)
                                                  - \q (Salir de la BD)
                                                  - exit (Salirnos del contenedor)

                                                  • Forma Interfaz
                                                  - Ir al archivo docker-compose.yml: Agregar el servicio de pgadmin
                                                  - Ejecutar contenedor docker: docker-compose up -d pgadmin (Se debe tener abierto docker)
                                                  - Verificar que está corriendo: docker-compose ps
                                                  - DEBEMOS CAMBIAR POR EL PEURTO CORRECTO Y USUARIO EN LAS VARIABLES DE ENTORNO
                                                  - CAMBIAR LA BASE DE DATOS EN EL ARCHIVO: libs/sequelize
                                                  - Vemos que hay 2 contenedores corriendo, en el navegador ir al puerto de contenedor pgadmin
                                                  - Una ves estamos en la página con el puerto (http://localhost:5050/), Seleccionar el server
                                                    que está a la izquierda del dashboard, click en object, register, servidor.
                                                  - En el general: Agregar nombre
                                                  - En la consola del vs, ejecutar: docker ps, así podremos tomar el id del contenedor. Una vez
                                                    tenemos el id, ejecutar: docker inspect 117722e3ad16 (id del contenedor), así podremos
                                                    obtener la ip address.
                                                  - En Conexion: Agregar el ip address tomado en el paso anterior, nombre de la BD (ver archivo
                                                    docker-compose.yml), usuario y contraseña. (EN VEZ DE LA IP ADDRESS ES MEJOR COLOCAR EL
                                                    NOMBRE DEL CONTENEDOR, EN NUESTRO CASO: postgresMyDB, ESTO SE DEBE A QUE LA IP VA CAMBIANDO
                                                    CADA QUE SE DESTRUYE EL CONTENEDOR).
                                                  - Guardamos y finalmente tenemos nuestra BD en motor gráfico.
                                                  - Correo el siguiente script de SQL y verificar que se creo correctamente:
                                                    CREATE TABLE tasks (
                                                      id serial PRIMARY KEY,
                                                      title VARCHAR ( 250 ) NOT NULL,
                                                      completed boolean DEFAULT false
                                                    );

• Conexión Nodejs-Postgres •

4. Instalar la dependencia: npm i pg

5. Crear la carpeta: libs

6. Crear el archivo: libs/postgres.js

7. Crear el archivo: libs/postgres.pool.js

8. Implementar las conexiones y pool creado en los servicios

9. Variables de ambiente: - Crear la carpeta: config
                          - Crear el archivo: config/config.js
                          - Implementarlas en los archivos de conexión que están en la carpeta: libs
                          - Crear el archivo: .env (Agregarlo a .gitignore)
                          - Crear el archivo: .env.example
                          - Instalar la dependencia: npm i dotenv (Permite leer el archivo .env e Implementarlo en el archivo config/config)

• ORM - Sequelize •

10. Instalar la dependencia: npm i --save sequelize

11. Instalar la dependencia: npm i --save pg pg-hstore

12. Crear el archivo: libs/sequelize.js

13. Implementar la conexión con el ORM sequelize en los servicios

14. Crear la carpeta: db

15. Crear  la carpeta: db/models

16. Crear el archivo: db/models/user.model.js

17. Crear el archivo: db/models/index.js

• Cambiar la base de datos a MySQL •

18. Instalar la dependencia: npm i --save mysql2

19. Configuración de MySQL en Docker: - En esta url podemos encontrar información sobre las imágenes: https://hub.docker.com/
                                      - Crear la carpeta: mysql_data (Acá se guardara la persistencia)
                                      - Agregar en el archivo .gitignore: mysql_data (Para que no persista en el repo)
                                      - Agregar el servicio mysql en el archivo: docker-compose.yml
                                      - Ejecutar contenedor docker: docker-compose up -d mysql (Se debe tener abierto docker)
                                      - Verificar que está corriendo: docker-compose ps
                                      - Dejar de ejecutar contenedor docker: docker-compose down

20. Explorar nuestra BD que está en un contenedor: • Forma Interfaz
                                                   - Ir al archivo docker-compose.yml: Agregar el servicio de phpmyadmin
                                                   - Ejecutar contenedor docker: docker-compose up -d phpmyadmin (Se debe tener abierto docker)
                                                   - Verificar que está corriendo: docker-compose ps
                                                   - DEBEMOS CAMBIAR POR EL PEURTO CORRECTO Y USUARIO EN LAS VARIABLES DE ENTORNO
                                                   - CAMBIAR LA BASE DE DATOS EN EL ARCHIVO: libs/sequelize
                                                   - Vemos que hay 2 contenedores corriendo, en el navegador ir al puerto de contenedor phpmyadmin
                                                   - Logeranos en el puerto (http://localhost:8080/)
                                                   - Correo el siguiente script de SQL y verificar que se creo correctamente:
                                                     CREATE TABLE tasks (
                                                      id serial PRIMARY KEY,
                                                      title VARCHAR ( 250 ) NOT NULL,
                                                      completed boolean DEFAULT false
                                                     );

• Migraciones •

21. Instalar la dependencia: npm i sequelize-cli -D (Nos ayuda a crear las migraciones)

22. Crear el archivo: .sequelizerc (Tienen su propia conexión)

23. Crear el archivo: db/config.js

24. Crear la carpeta: db/migrations

25. Crear la carpeta: db/seeders

26. Configurar los scripts para correr las migraciones: - Ir al archivo package.json
                                                        - Agregar el script para generar: "migrations:generate": "sequelize-cli migration:generate --name"
                                                        - Ejecutar en consola el script: npm run migrations:generate create-user
                                                        - El anterior script nos crea una pieza de código lista para correr migraciones,
                                                          manualmente debemos decirle que hacer y como en el archivo: db/migrations
                                                        - Agregar el script para correr: "migrations:run": "sequelize-cli db:migrate"
                                                        - Agregar el script para rollback: "migrations:revert": "sequelize-cli db:migrate:undo"
                                                        - Eliminar manualmente las tablas de la BD
                                                        - Ejecutar en consola el comando: npm run migrations:run
                                                        - La tabla adicional creada: SequelizeMeta, contiene el historial de migraciones,
                                                          cómo tiene el registro, no vuelve a ejecutar las migraciones que ya estan en el
                                                          historial.

27. Agregando un after table (Modificar una tabla, agregar o quitar un atributo): - Crear un nuevo campo en el archivo: db/models/user.model
                                                                                  - Ejecutar en consola el script: npm run migrations:generate add-role-to-user
                                                                                  - Agregar el campo también en el archivo: schemas/users/user.schema
                                                                                  - Ejecutar en consola el comando: npm run migrations:run

• Relaciones •

28. Relaciones uno a uno (Customer ----- User): - Realizar la relación en el archivo: models/customer.model.js
                                                - Ejecutar las relaciones en el archivo: models/index.js
                                                - Ejecutar en consola el script: npm run migrations:generate create-customer
                                                - El anterior script nos crea una pieza de código lista para correr migraciones,
                                                  manualmente debemos decirle que hacer y como en el archivo: db/migrations
                                                - Ejecutar en consola el comando: npm run migrations:run
                                                - Modificar el metodo find para incluir asociación en el archivo: services/customers/customer.service.js
                                                - Realizar la relación en el archivo: models/user.model.js
                                                - Ejecutar las relaciones en el archivo: models/index.js
                                                - Modificar el metodo find para incluir asociación en el archivo: services/users/user.service.js
                                                - Modificar el esquema: schemas/customers/customer.schema.js

29. Relaciones uno a muchos (Caterogy ----> Product): - Realizar la relación en el archivo: models/category.model.js
                                                      - Realizar la relación en el archivo: models/product.model.js
                                                      - Ejecutar las relaciones en el archivo: models/index.js
                                                      - Ejecutar en consola el script: npm run migrations:generate products
                                                      - El anterior script nos crea una pieza de código lista para correr migraciones,
                                                        manualmente debemos decirle que hacer y como en el archivo: db/migrations
                                                      - Ejecutar en consola el comando: npm run migrations:run





